version: "3.8"

services:
    app:
        build: ./infra/php
        volumes:
            - ./backend:/work/backend 

    web:
        build: ./infra/nginx
        ports:
            - 10080:80
        volumes:
            - ./backend:/work
            - ./infra/nginx/default.conf:/etc/nginx/conf.d/default.conf
        working_dir: /work
    
    db:
        build: ./infra/mysql
        ports:
            - 3306:3306
        volumes:
            - db-store:/var/lib/mysql
    
    phpmyadmin:
        image: phpmyadmin/phpmyadmin
        environment:
            - PMA_ARBITRARY=1
            - PMA_PORT=3306
            - PMA_HOST=laravel_local
            - PMA_USER=phper
            - PMA_PASSWORD=secret
        depends_on:
            - db
        ports:
            - 28080:80
    
    mockapi:
        image: danielgtaylor/apisprout:latest
        container_name: 'mockapi'
        ports:
            - '9003:8000'
        volumes:
            - ../openapi.yaml:/openapi.yaml
        entrypoint: /usr/local/bin/apisprout /openapi.yaml --watch

volumes:
    db-store: